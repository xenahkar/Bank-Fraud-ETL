# ETL по выявлению мошеннических банковских операций

## Описание проекта

В данном проекте разработан ETL-процесс, который ежедневно выполняет следующие задачи:

### **Прием входящих данных**:
   - Данные о транзакциях, терминалах и черном списке паспортов из файлов.
   - Данные о клиентах, счетах и картах из базы данных.

### **Загрузка данных в бд**:
   - Создание временных таблиц для предварительной обработки данных (STG).
   - Наполнение основных таблиц измерений (DIM) и фактов (FACT).

### **Выявление мошеннических операций**:

Построение витрины данных мошеннических операциях с выявленными мошенническими операциями по заданным правилам. Витрина строится накоплением, каждый новый отчет за новый день укладывается в эту же таблицу с новым `report_dt`. В таблицу **`public.kkar_rep_fraud`** будет записана каждая операция, соответствующая одному из следующих типов мошенничества:

1. **Операция с просроченным или заблокированным паспортом**.

2. **Операция при недействующем договоре**

3. **Совершение операций в разных городах в течение одного часа.**

4. **Попытка подбора суммы**: в течение 20 минут происходит более 3 операций с последовательными суммами, где каждая последующая меньше предыдущей, при этом отклонены все, кроме последней. Последняя операция (успешная) в такой цепочке считается мошеннической.
  

В таблице **`public.kkar_rep_fraud`**  содержатся следующие поля:

- **`event_dt`**: Дата и время события.
- **`passport`**: Номер паспорта клиента.
- **`fio`**: ФИО клиента (из таблицы клиентов).
- **`phone`**: Номер телефона клиента.
- **`event_type`**: Описание типа мошенничества (численное обозначение мошеннической операции, например, 1 — операция с просроченным или заблокированным паспортом).
- **`report_dt`**: Дата создания отчета.

### **Автоматизация процесса**:
   - Настройка ежедневного запуска в 02:00 файла `main.py` через планировщик задач (cron).
  

## Описание репозитория

- **`main.ddl`**: SQL код для создания объектов в базе данных.
- **`main.py`**: Основной процесс обработки.
- **`main.cron`**: Файл для расписания процесса в crontab.
- **`data/`**: Файлы с транзакциями, терминалами и паспортами из "черного списка" за три дня.
- **`archive/`**: Пустой каталог для отработанных файлов.
- **`sql_scripts/`**:  SQL скрипты, вынесенные в отдельные файлы.

---

В файле `config.py` в классе Config нужно указать данные для подключения к базе данных:

    class Config:
        remote = {
            'database': DB,
            'host': HOST,
            'user': USER,
            'password': PASSWORD,
            'port': PORT
        }
